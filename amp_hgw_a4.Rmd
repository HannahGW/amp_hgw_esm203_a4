---
title: "Change in Lobster Abundance and Size off the Santa Barbara Coast (2012-2018)"
author: "Hannah Garcia-Wickstrum & Anne-Marie Parkinson"
date: "11/6/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE)
```

### Introduction

work in progress 

In 2000, the Santa Barbara Coastal Term Ecological Long-Term Research (SBC LTER) program was established to better understand kelp forest ecosystems in southern California (https://sbclter.msi.ucsb.edu/ ; create citation later). Spiny lobsters (*Panulirus interruptus*, Figure 1), which are a focus of one of many SBC LTER studies, are an important predators in gaint kelp forests (Reed, 2019). Lobster abundance, size, and fishing pressure are part of an annual, on-going study that started in 2012 until, most recently, 2018. Studies were conducted at 5 sites near Santa Barabra County: Carpinteria, Isla Vista, Arroyo Quemado, Mohawk, and Naples (Figure 2). On January 1, 2012, marine protected areas (MPAs) were established at the Isla Vista and Naples sites. 

MPA citation: https://wildaid.org/marine-protected-areas-101/




![](figures/wikipedia_lobster_Ed_Bierman.jpg)

**Figure 1:** California spiny lobsters (*Panulirus interruptus*) emerging from under a rock. Photo credit: Ed Bierman, [Wikipedia](https://en.wikipedia.org/wiki/California_spiny_lobster). 




![](figures/lobster_survey_sites.jpg)

**Figure 2:** Map of the 5 locations lobster surveys took place. Survey sites from left to right: Arroyo Quemado, Naples (MPA), Isla Vista (MPA), Mohawk, Carpinteria. 





### Data and Methods

Data for spiny lobster abundance, size, and fishing efforts was collected from August 2012 to December 2018 by the [Santa Barbara Coastal Long-Term Ecological Research (LTER)](http://sbc.lternet.edu//index.html). Data was collected annually by divers in late summer before the start of fishing season at five long-term kelp forest study sites. For more information on collection methods and spatial information, please see the [metadata](https://portal.edirepository.org/nis/mapbrowse?scope=knb-lter-sbc&identifier=77&revision=newest). Lobster counts were based on visual observations from a diver searching 2.5 m areas on opposite sides of a 60 m transect tape. Counts and sizes (mm) of lobsters were compared in Marine Protected Areas (MPA) and Non-Marine Protected Areas (Non-MPA). The differences in mean lobster size in MPAs and Non-MPAs were compared by two-sample t-tests ($\alpha$ = 0.05 throughout). Trends in lobster counts and sizes were compared in MPA and Non-MPA by linear regression. All analyses and figures were prepared using R software version 3.6.1. Collaboration between authors was done using GitHub. 

### Results
#### Result A: Changes in lobster abundance by site (2012 - 2018)

The impact of creating Marine Protected Areas (MPAs) on lobster abundance can be seen in Figure 2. At the Isla Vista MPA, lobster abundance dramatically increased over 3,500% from 26 to 946 observed lobsters from 2012 to 2018; Isla Vista had the highest number of lobster observations in 2018. While lobster abundance at the Naples MPA wasn't as high as that at Isla Vista MPA in 2018 (n=298), Naples had a larger percent increase (over 4,800% increase) from 2012-2018. Comparatively, lobster abundance at the non-MPA sites, Carpinteria, Arroyo Quemado and Mohawk, only had a 339%, 98%, and 42% increase from 2012-2018, respectively.  


The total number of lobsters in MPAs increased over 3,700% from 32 lobster observations in 2012 to 1,244 lobster observations in 2018. In the three non-MPA study sites, the total number of observed lobsters only increased 182% from 199 lobsters in 2012 to 561 lobsters in 2018.  

Talk a bit about the general fluctions/trends of the lines? ex/ aque stayed relatively constant throughout the study period?
```{r}
# Install packages

library(tidyverse)
library(janitor)
library(here)
library(tidyr)
library(kableExtra)
library(effsize)
library(dplyr)

# Read in data and clean/wrangle

lobster_abundance_sbc <- read_csv(here::here("data", "lobster_abundance_sbc_lter.csv"),
                                  na = "-99999") %>%
  janitor::clean_names() %>%  
  mutate(site_name_long = case_when(
    site %in% c("CARP") ~ "Carpinteria" ,
    site %in% c("IVEE") ~ "Isla Vista",
    site %in% c("AQUE") ~ "Arroyo Quemado",
    site %in% c("MOHK") ~ "Mohawk", 
    site %in% c("NAPL") ~ "Naples"))  %>% 
  mutate(MPA = case_when( 
    site %in% c("IVEE", "NAPL") ~ "MPA",
    site %in% c("AQUE", "CARP", "MOHK") ~ "Non MPA"))

```


```{r}
# annual lobster sub data set

annual_lobsters <- lobster_abundance_sbc %>% 
  group_by(site_name_long, year, MPA) %>% 
  summarise(yearly_lobsters=sum(count)) 
 
# graph of annual lobster counts from 2012 - 2018

ggplot(annual_lobsters, aes(x=year, y=yearly_lobsters)) +
  geom_line(aes(color=site_name_long), show.legend = FALSE) +
  geom_point(aes(color = site_name_long), show.legend = FALSE) + 
  theme_minimal() +
  labs(x = "\nYear", y = "Annual Number of Observed Lobsters\n", 
       title="Annual Lobster Abundance from 2012-2018\n") +
  coord_cartesian(clip="off", 
                  xlim=c(2012,2018)) +
  theme(plot.margin=unit(c(1,10,1,1), "lines"),
        plot.title = element_text(hjust=0.5),
        legend.position = "right",
        legend.title=element_blank()) +
  scale_fill_discrete(name= "MPA Status") +
  scale_color_manual(values = c("black", "black", "maroon", "black", "maroon")) +
  scale_x_continuous(lim=c(2012, 2018), 
                     expand=c(0,0)) +
  scale_y_continuous(lim=c(0, 1000), 
                     expand=c(0,0),
                     breaks=seq(0,1000, by=250)) +
  annotate("text", label= "Isla Vista", 
           x = Inf, 
           y = 940, 
           size = 3,
           hjust = -0.2,
           vjust = 0,
           color = "maroon") +
  annotate("text", label = "Naples",
           x = Inf,
           y = 270,
           size = 3,
           hjust = -0.25,
           vjust = 0,
           color = "maroon") +
  annotate("text", label = "Arroyo Quemado",
           x = Inf,
           y = 33,
           size = 3,
           hjust = -0.1,
           vjust = 0) +
  annotate("text", label = "Mohawk",
           x = Inf,
           y = 145,
           size = 3,
           hjust = -0.2,
           vjust = 0) +
  annotate("text", label = "Carpinteria",
           x = Inf,
           y = 330,
           size = 3,
           hjust = -0.18,
           vjust = 0)
 
```
***Figure 3.** Lobster counts in MPAs (in red) and non-MPAs (in black). MPAs were established on January 1, 2012. Lobsters were counted in the months of August through December from 2012-2018. Data: SBC LTER.*


#### Result B: Lobster size distribution shifts, 2012 vs 2018

The lobster size distribution in the five study sites is shown in Figure 4. Lobster size distribution has stayed relatively constant for four of the five sites: Arroyo Quemado (2012 n=19, 2018 n=27), Carpinteria (2012 n= 39, 2018 n=172), Mohawk (2012 n= 41, 2018 n=82), and Naples (2012 n= 3, 2018 n=149). For these sites, most lobster sizes were around 80mm in both 2012 and 2018. The distributions became narrower and more centrlized around the mean between 2012 and 2018. (does this last sentence make sense? im trying to explain that the 2018 distribution is skinnier). This may be due to the small sample size in 2012, relative to 2018. Likely, a larger sample contained more of the true size distribution at each site.  However, lobster sizes at Isla Vista changed from 2012 to 2018. The lobster sizes were skewed to the left (or right?) in 2012 (n=13), with most surveyed lobster sizes observed around 60mm, but in 2018 (n=472) the distribution of lobster sizes followed a normal distribition that is similar to that of the other 4 sites; most lobster sizes are even around 80mm.


```{r}
# Uncount lobster observations
lobster_abundance_tidy <- lobster_abundance_sbc %>%
  tidyr::uncount(count)

# sub-data: keep only years 2012 and 2018
lobster_size <- lobster_abundance_tidy %>%
  filter(year %in% c("2012", "2018"))%>% 
  mutate(year=as.character(year)) ### this code added becuase ggplot wouldnt recognize our year column correctly (would display color based on year aesthetic). Changing the values to characters helped over come this error

# determine sample size for each class/year
num_observations <- lobster_size %>% 
  group_by(site) %>% 
  count(year)

# graph for distribution of lobster sizes in 2012 and 2018 
ggplot(lobster_size, aes(x=size_mm)) +
  geom_density(aes(fill=year), position='identity', alpha=0.5) +
  theme_minimal() +
  labs(x="Size (mm)", y="Density\n", title="Change in lobster size distribution between 2012 and 2018") +
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous(lim=c(30, 130), expand=c(0,0), breaks=seq(30,120, by=20)) +
  scale_y_continuous(lim=c(0, 0.06), expand=c(0,0)) +
  facet_wrap(~site_name_long, scales="free_x") +
  scale_fill_discrete(name="Year")

```

***Figure 4:** The change in lobster size (mm) distributions at five sites on the California coast in 2012 (pink) and 2018 (blue). Population sizes in 2012 range from n=3 to n=41, and were lower than population sizes in 2018, which range from n=27 to n=472. MPA sites (Isla Vista and Naples) show higher densities of larger-sized lobsters in 2018 compared to 2012. Data: SBC LTER.*

 

#### Result C: Is there a differnce between mean lobster sizes at MPA vs Non-MPA sites (2012 - 2018)?

```{r, include=FALSE}

# Q-Q plots to explore data and check for normal distribution/linear regressions

  # QQ plot for sample size for 2012 lobsters - distribution is normal.
lobster_size_2012 <- lobster_size %>%
  filter(year == 2012)

ggplot(lobster_size_2012, aes(sample = size_mm)) +
  geom_qq()

  # QQ plot for sample size for 2018 lobsters - distribution is normal.
lobster_size_2018 <- lobster_size %>%
  filter(year == 2018)

ggplot(lobster_size_2018, aes(sample = size_mm)) +
  geom_qq()

  # QQ plot for MPA only site for distribution of sample lobster size - distribution is normal. 
lobster_size_MPA <- lobster_size %>%
  filter(MPA == "MPA")

ggplot(lobster_size_MPA, aes(sample = size_mm)) +
  geom_qq()

  # QQ plot for Non-MPA only site for distribution of sample lobster size - distribution is normal. 
lobster_size_Non_MPA <- lobster_size %>%
  filter(MPA == "Non MPA")

ggplot(lobster_size_Non_MPA, aes(sample = size_mm)) +
  geom_qq()

# Question 1:For 2012 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

  # H null = there is no difference in MPA vs non-MPA lobster size in 2012
  # H alternative = there is a difference in MPA vs non-MPA lobster size in 2012
  # significance value: p = 0.05
  # stat test= 2 sample t test

# sub-data: only include observations from 2012
lobster_size_2012 <- lobster_size %>% 
  filter(year==2012) 

#  welch's 2 sample t test

size_ttest_2012 <- t.test(size_mm ~ MPA, data=lobster_size_2012)

size_ttest_2012

#trial for kazias code
mpa_2012 <-  lobster_abundance_sbc %>% 
  filter(year==2012, MPA== "MPA") %>% 
  pull(size_mm)
nonmpa_2012 <- lobster_abundance_sbc %>% 
  filter (year==2012, MPA== "Non MPA") %>% 
  pull(size_mm)

t.test(mpa_2012, nonmpa_2012)


# Question 2: For 2018 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

  # H null = there is no difference in MPA vs non-MPA lobster size in 2018
  # H alternative = there is a difference in MPA vs non-MPA lobster size in 2012
  # significance value: p = 0.05
  # stat test= 2 sample t test

# sub-data: only include observations from 2018
lobster_size_2018 <- lobster_size %>% 
  filter(year==2018) 

#  welch's 2 sample t test

size_ttest_2018 <- t.test(size_mm ~ MPA, data=lobster_size_2018)

size_ttest_2018

# effect size (p< 0.05)

Q2_effectsize <- cohen.d(lobster_size_2018$size_mm, lobster_size_2018$MPA) 


# Question 3:	For MPA sites only, is there a significant difference in lobster size means observed in 2012 vs. 2018?

  # H null = there is no difference in lobster observations in MPAs in 2012 vs MPAs in 2018
  # H alternative = there is a difference in MPA 2012 vs MPA 2018 lobster size
  # significance value: p = 0.05
  # stat test= 2 sample t test

# sub-data: only include MPA observations from 2012 and 2018
lobster_size_MPA <- lobster_size %>% 
  filter(MPA == "MPA") 

#  welch's 2 sample t test

MPA_size_ttest <- t.test(size_mm ~ year, data=lobster_size_MPA)

MPA_size_ttest

#effect size (p < 0.05)
Q3_effectsize <- cohen.d(lobster_size_MPA$size_mm, lobster_size_MPA$year) 

Q3_effectsize

# Question 4: For non-MPA sites only, is there a significant mean size difference in lobsters observed in 2012 vs. 2018?

  # H null = there is no difference in MPA 2012 vs MPA 2018 lobster size
  # H alternative = there is a difference in MPA 2012 vs MPA 2018 lobster size
  # significance value: p = 0.05
  # stat test= 2 sample t test

# sub-data: only include Non MPA observations from 2012 and 2018
lobster_size_Non_MPA <- lobster_size %>% 
  filter(MPA == "Non MPA") 

#  welch's 2 sample t test
Non_MPA_size_ttest <- t.test(size_mm ~ year, data=lobster_size_Non_MPA)

Non_MPA_size_ttest

```



```{r}
# data from 1: mean and standard deviation for MPA and non MPAs in 2012 and 2018
lobster_size_stats <- lobster_size %>% 
  group_by(year, MPA) %>% 
  summarize(Mean=mean(size_mm), 
            Standard_Deviation=sd(size_mm))


# data frame 2: sample size for MPA and non MPAs in 2012 and 2018
num_observations <- annual_lobsters %>%
    group_by(MPA, year) %>% 
    summarize(sample_size=sum(yearly_lobsters)) %>% 
    ungroup(year) %>% 
    mutate(year=as.character(year)) %>% 
    dplyr::filter(year %in% c("2018", "2012"))  # fixed it!!

# merge data frames 
lobster_size_table_merged <- inner_join(lobster_size_stats, num_observations, by=c("MPA", "year"))

# create table with mean, standard deviation, and sample size for MPA and non MPAs in 2012 and 2018
lobster_table <- lobster_size_table_merged %>%
  kable(col.names = c("Year", 
                    "MPA status",
                    "Mean lobster size (mm)",
                    "Standard deviation",
                    "Sample population")) %>%
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                position = "center") %>%
  add_header_above(c("Mean lobster sizes at MPA vs Non-MPA sites in 2012 and 2018" = 5)) 

lobster_table


```

***Figure 5.** Results from two sample t-tests comparing mean lobster sizes at MPA and Non-MPA sites in 2012 and 2018. Data: SBC LTER.*

It is worth noting that all size observations recorded by divers were visually estimated. There is a chance that actual lobster size varies. Effect sizes recorded below do not account for the accuracy of assessment (Sullivan and Feinn, 2012). (do you think this paragraph is needed?)

For observations in 2012, mean lobster sizes between MPA (`r round(size_ttest_2012$estimate[1],2)`) and Non-MPA sites (`r round(size_ttest_2012$estimate[2],2)`) did not differ significantly (t(`r round(size_ttest_2012$parameter,2)`) = `r round(size_ttest_2012$statistic,2)`, *p* = `r round(size_ttest_2012$p.value,2)`) according to the p-value. The actual difference in means for 2012 (`r round(size_ttest_2012$estimate[1],2)`) and 2018 (`r round(size_ttest_2012$estimate[2],2)`) is 4.91. We determined that the p-value came back as insignificant because of the low sample sizes collected in 2012. In 2012, only 115 observations were recorded for both MPA and non-MPAs, compared to 2018 where 902 observations were recorded for both MPA and non-MPAs.  

For observations in 2018, mean lobster sizes between MPA (`r round(size_ttest_2018$estimate[1],2)`) and non-MPA sites (`r round(size_ttest_2018$estimate[2],2)`) did vary significantly (t(`r round(size_ttest_2018$parameter,2)`) = `r round(size_ttest_2018$statistic,2)`, *p* = `r round(size_ttest_2018$p.value,2)`). To measure the magnitude of the difference between MPA and non-MPA sites in 2018, we calcualted the effect size (`r round(Q2_effectsize$estimate,1)`). A relatively smaller effect size revealed that though the difference in means was more difficult to observe, there was indeed a difference between population means. 

In MPA sites, the difference in mean lobster size observations in 2012 (`r round(MPA_size_ttest$estimate[1],2)`) and 2018 (`r round(MPA_size_ttest$estimate[2],2)`) did vary significantly (t(`r round(MPA_size_ttest$parameter,2)`) = `r round(MPA_size_ttest$statistic,2)`, *p* = `r round(MPA_size_ttest$p.value,2)`). The large effect size (`r round(Q3_effectsize$estimate,1)`) for MPA sites reveals that the difference in lobster means in 2012 and 2018 was indeed substantial.  
(Do you think this is finished?)

In Non-MPA sites, the difference in mean lobster size observations in 2012 (`r round(Non_MPA_size_ttest$estimate[1],2)`) and 2018 (`r round(Non_MPA_size_ttest$estimate[2],2)`) did not vary significantly (t(`r round(Non_MPA_size_ttest$parameter,2)`) = `r round(Non_MPA_size_ttest$statistic,2)`, *p* = `r round(Non_MPA_size_ttest$p.value,2)`). When looking at the acutal means of the two samples, we determined that the p-value was true and that the two sample means did not vary significantly. No effect size test was necessary. (is that ok to say??) (do you agree this is finished?)

### Summary

- 
-
-


### Citations 

**Bierman, Ed.** "California spiny lobster." *Wikipedia*, 09/17/2016, https://en.wikipedia.org/wiki/California_spiny_lobster.

**Reed D. 2019.** SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012. Environmental Data Initiative. https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0. Dataset accessed 11/13/2019.

**Sullivan, Gail M, and Richard Feinn.** “Using Effect Size-or Why the P Value Is Not Enough.” Journal of graduate medical education vol. 4,3 (2012): 279-82. doi:10.4300/JGME-D-12-00156.1. Date accessed 11/16/2019. 